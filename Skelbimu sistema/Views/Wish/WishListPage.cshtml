@model List<Wish> // Update model to receive product list and userId

@{
    ViewData["Title"] = "Wish list";
    int currentUserId = (int)ViewData["UserId"];


}

@if (TempData["SuccessMessageWishList"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessageWishList"]
    </div>
}

    <div class="text-center">
        <h1 class="display-4">Jūsų norai</h1>
    </div>

    <div class="container">
        <div class="row">
            @foreach (var wish in Model)
            {
                if (wish.UserId == currentUserId)
                {
                <div class="row">

                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h4 class="card-title">Pavadinimas: @wish.Name</h4>
                                <p class="card-text">Raktažodžiai: @wish.SearchKeyWords</p>
                                <p class="card-text">Kaina nuo: $@wish.PriceLow</p>
                                <p class="card-text">Kaina iki: $@wish.PriceHigh</p>
                                <p class="card-text">Kategorija: @wish.Category</p>
                                <p class="card-text">Norimas mokėjimo būdas: @wish.PaymentMethod</p>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-danger" onclick="deleteWish('@wish.Id')">Naikinti</button>
                                <button class="btn btn-primary" onclick="editWish('@wish.Id')">Redaguoti</button>
                            </div>
                        </div>
                    </div>

                </div>
                }
            }
        </div>
    </div>

 <script>
    function deleteWish(wishId) {
        if (confirm('Ar tikrai norite ištrinti šį norą?')) {
            var token = $('input[name="__RequestVerificationToken"]').val(); // Get anti-forgery token
            $.ajax({
                url: '/Wish/Delete/' + wishId, // Update the URL to match the correct route
                type: 'POST',
                data: { id: wishId, __RequestVerificationToken: token }, // Pass the anti-forgery token
                success: function (response) {
                    displaySuccessMessage('Noras sėkmingai ištrintas!');
                    location.reload();
                },
                error: function (xhr, status, error) {
                    console.error('Klaida trinant norą:', error);
                    displaySuccessMessage('Noras neištrintas!');
                }
            });
        }
    }

    function editWish(wishId) {
        // Implement edit functionality here

        window.location.href = '/Wish/Edit?id=' + wishId;
    }

    // Function to display success message to user
    function displaySuccessMessage(message) {
        // You can implement this function to display the success message in your desired way
        // For example, you can show a notification, alert, or update a specific element on the page
        alert(message); // This is a simple example using alert
    }

</script> 

